---
title: "6306_case_study1"
output: html_document
---

```{r, echo=FALSE, message=FALSE}
rm( list = ls()); cat("\014")  # Clear environment
#install.packages('dplyr')
#install.packages('stringr')
#install.packages("ggplot2")
library("ggplot2")
```

## Questions:
## 1  Merge the data based on the country shortcode. See how many of the IDs match;
## 2  Sort the data frame in ascending order by GDP (so United States is last). What is the 13th country in the resulting data frame?
## 3	What are the average GDP rankings for the "High income: OECD" and "High income: nonOECD" groups? 
## 4	Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group.
## 5	Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group. How many countries are Lower middle income but among the 38 nations with highest GDP?

#### use only columns country.code, country.name, rank, gdp and Income.Group for data analysis.
```{r, echo=FALSE, message=FALSE}
# generates clean data frames merged.data from R.
source('source/clean_data.R')
merged.data.sub <- merged.data[,c("country.code","country.name","rank","gdp","Income.Group")]
```

***
## 1  Merge the data based on the country shortcode. See how many of the IDs match;
```{r, echo=TRUE, message=FALSE}
nrow(merged.data)
```
>* 189 IDs match country shortcodes

***
## 2  Sort the data frame in ascending order by GDP (so United States is last). What is the 13th country in the resulting data frame?
### Sort the data by GDP
```{r, echo=TRUE, message=FALSE}
order.data<-merged.data.sub[order(merged.data.sub$gdp),]
```

### Find out the 13th country in the orded data
```{r, echo=TRUE, message=FALSE}
order.data[13,]$country.name
```
>* The 13th country is St. Kitts and Nevis


***
## 3	What are the average GDP rankings for the "High income: OECD" and "High income: nonOECD" groups?
### High income: OECD

```{r, echo=TRUE, message=FALSE}
hiOECD<-mean(merged.data.sub$rank[which(merged.data.sub$Income.Group=="High income: OECD")])
hiOECD
```


### High income: non OECD
```{r, echo=TRUE, message=FALSE}
hiNonOECD<-mean(merged.data.sub$rank[which(merged.data.sub$Income.Group=="High income: nonOECD")])
hiNonOECD
```

>* The average GDP ranking for high income OECD nations is 32.97
>* The average GDP ranking for high income nonOECD nations is 91.913

***
## 4	Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group.


* Histogram of GDP for all countries, colors grouped by Income.Group
```{r, echo=TRUE, message=FALSE}

```

* Scatterplot of GDP for all countries, colors grouped by Income.Group
```{r, echo=TRUE, message=FALSE}
## GDP converted to log10 scale for better data visualization
merged.data.sub$loggdp <- log10(merged.data.sub$gdp * 1000000)
#ggplot(merged.data.sub, aes(x=rank, y=loggdp)) + 
  # fill depends on Income.Group
#  geom_bar(aes(fill=Income.Group),  
#           stat="identity"
#  )+
  # Added axises title and hide x-axis text
#  labs(x = "Country (Higher incomes in left)",y="Log GDP(USD)",title="GDP by Income Group") +
#  theme(axis.text.x=element_blank(),
#        axis.ticks.x=element_blank())
#sorted.data <- merged.data.sub[order(gdp)]
#sorted.data[ra]
ggplot(merged.data.sub, aes(x=rank, y=loggdp)) + 
  # ?Draw lines in same group. colour, group both depend on Income.Group
  # geom_line(aes(colour=Income.Group, group=Income.Group)) + 
  # Set points. colour depends on Income.Group
  geom_point(aes(colour=Income.Group),size=1)+ 
  # # Added axises title and hide x-axis text
  labs(x = "Country Code",y="log scale GDP (USD)",title="GDP by Income Group") +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
```

***

#*******************************************************************************************
## 5	Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group. How many countries are Lower middle income but among the 38 nations with highest GDP?


```{r, echo=TRUE, message=FALSE}
merged.data.sub$rankgroups <- cut(merged.data.sub$rank, breaks=5)
table(merged.data.sub$rankgroups,merged.data.sub$Income.Group)
```

>* 5 countries are Lower middle income but among the 38 nations with highest GDP